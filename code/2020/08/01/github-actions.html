<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Github actions for automated testing | David Masip’s notes</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Github actions for automated testing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A beginner’s guide" />
<meta property="og:description" content="A beginner’s guide" />
<link rel="canonical" href="https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html" />
<meta property="og:url" content="https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html" />
<meta property="og:site_name" content="David Masip’s notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-01T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html"},"description":"A beginner’s guide","@type":"BlogPosting","url":"https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html","headline":"Github actions for automated testing","dateModified":"2020-08-01T00:00:00-05:00","datePublished":"2020-08-01T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/david-masip-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://david26694.github.io/david-masip-blog/feed.xml" title="David Masip's notes" /><link rel="shortcut icon" type="image/x-icon" href="/david-masip-blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Github actions for automated testing | David Masip’s notes</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Github actions for automated testing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A beginner’s guide" />
<meta property="og:description" content="A beginner’s guide" />
<link rel="canonical" href="https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html" />
<meta property="og:url" content="https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html" />
<meta property="og:site_name" content="David Masip’s notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-01T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html"},"description":"A beginner’s guide","@type":"BlogPosting","url":"https://david26694.github.io/david-masip-blog/code/2020/08/01/github-actions.html","headline":"Github actions for automated testing","dateModified":"2020-08-01T00:00:00-05:00","datePublished":"2020-08-01T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://david26694.github.io/david-masip-blog/feed.xml" title="David Masip's notes" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script type="text/javascript">
require.config({
  paths: {
    jquery: 'https://code.jquery.com/jquery-3.5.0.min',
    plotly: 'https://cdn.plot.ly/plotly-latest.min'
  },

  shim: {
    plotly: {
      deps: ['jquery'],
      exports: 'plotly'
    }
  }
});
</script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/david-masip-blog/">David Masip&#39;s notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/david-masip-blog/about/">About Me</a><a class="page-link" href="/david-masip-blog/search/">Search</a><a class="page-link" href="/david-masip-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Github actions for automated testing</h1><p class="page-description">A beginner's guide</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-01T00:00:00-05:00" itemprop="datePublished">
        Aug 1, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/david-masip-blog/categories/#code">code</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I recently started using github actions to test my python package <a href="https://github.com/david26694/sktools/">sktools</a>. It looks like a fairly easy tool to use, and I find it very powerful.</p>

<p>The idea is to create workflows that automate actions for you. According to the <a href="https://docs.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow">docs</a>:</p>

<blockquote>
  <p>Workflows are custom automated processes that you can set up in your repository to build, test, package, release, or deploy any project on GitHub.</p>
</blockquote>

<p>Creating a workflow is as simple as creating a yml file in <code class="highlighter-rouge">.github/workflows</code>. The file I’ve created looks like this, and it installs the sktools package in several environments and runs its tests:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Action title</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Unit Tests</span>

<span class="c1"># Controls when the action will run.</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>

<span class="c1"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># This workflow contains a single job called "build"</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="c1"># The type of runner that the job will run on</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">3.6</span><span class="pi">,</span> <span class="nv">3.7</span><span class="pi">]</span>
        <span class="na">os</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">macos-10.15</span><span class="pi">,</span> <span class="nv">ubuntu-latest</span><span class="pi">,</span> <span class="nv">windows-latest</span><span class="pi">]</span>

    <span class="c1"># Steps represent a sequence of tasks that will be executed as part of the job</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="c1"># Runs a single command using the runners shell</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python $</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s">$</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python -m pip install --upgrade pip</span>
        <span class="s">pip install sktools</span>
        <span class="s">pip freeze</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test with pytest</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">make test</span>
</code></pre></div></div>

<p>Let’s look at what each step does.</p>

<p>The <code class="highlighter-rouge">name</code> key is provided so it’ll be easily identified in the <a href="https://github.com/david26694/sktools/actions">actions tab</a>. The <code class="highlighter-rouge">on</code> key controls when the workflow will be run. In this case, it is scheduled via a cron that runs the action on a daily basis, at midnight.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Workflow title</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Unit Tests</span>

<span class="c1"># Controls when the action will run.</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>
</code></pre></div></div>

<p>Alternative <code class="highlighter-rouge">on</code> options are:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">master</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">master</span>
</code></pre></div></div>

<p>Which would run the workflow when master branch is updated and on pull requests. Of course <code class="highlighter-rouge">on</code> can handle all of them at the same time.</p>

<p>After that, you can specify several jobs for the workflow to run. In our case, we’ve specified a single job called <code class="highlighter-rouge">build</code>. We’ve also specified on which environments do we need to run it on. The idea is that the instructions that we’ll specify afterwards will run in mac, ubuntu and windows and both in python 3.6 and 3.7 for each of the OS. And this is without even having python 3.6 in my computer, and only one OS. This way I can ensure that my library works not only in my computer.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># This workflow contains a single job called "build"</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="c1"># The type of runner that the job will run on</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">3.6</span><span class="pi">,</span> <span class="nv">3.7</span><span class="pi">]</span>
        <span class="na">os</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">macos-10.15</span><span class="pi">,</span> <span class="nv">ubuntu-latest</span><span class="pi">,</span> <span class="nv">windows-latest</span><span class="pi">]</span>
</code></pre></div></div>

<p>In the following lines we define the steps that each execution of the workflow will carry. Each step is defined by a yaml key, the first one being the checkout. The checkout gets the latest commit of your repo. The second action, with name <code class="highlighter-rouge">Set up Python 3.x</code>, will create a python environment.</p>

<p>Both these steps are open source (<a href="https://github.com/actions/setup-python">setup python</a>, <a href="https://github.com/actions/checkout">checkout</a>), and you can also build your own custom steps.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1"># Steps represent a sequence of tasks that will be executed as part of the job</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="c1"># Runs a single command using the runners shell</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python $</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s">$</span>
</code></pre></div></div>

<p>The last steps are the most specific to our job. The “Install dependencies” job installs sktools and the last step runs the tests in sktools.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python -m pip install --upgrade pip</span>
        <span class="s">pip install sktools</span>
        <span class="s">pip freeze</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test with pytest</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">make test</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">make test</code> is specific to our project as we run the tests from a Makefile. However, as in the Makefile we have the lines</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test: 
	python setup.py test
</code></pre></div></div>

<p>changing the <code class="highlighter-rouge">make test</code> by <code class="highlighter-rouge">python setup.py test</code> won’t make any difference. By looking in the workflow run in the actions tab on github, we can see in its logs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test_basic_featurizer (tests.test_sktools.TestGroupQuantileFeaturizer) ... ok
test_missing (tests.test_sktools.TestGroupQuantileFeaturizer) ... ok
test_new_input (tests.test_sktools.TestGroupQuantileFeaturizer) ... ok
test_select_items (tests.test_sktools.TestItemSelector) ... ok
test_zero_matrix (tests.test_sktools.TestMatrixDenser) ... ok
test_basic_featurizer (tests.test_sktools.TestMeanFeaturizer) ... ok
test_missing (tests.test_sktools.TestMeanFeaturizer) ... ok
test_new_input (tests.test_sktools.TestMeanFeaturizer) ... ok
test_float_works (tests.test_sktools.TestTypeSelector) ... ok
test_integer_works (tests.test_sktools.TestTypeSelector) ... ok
test_object_works (tests.test_sktools.TestTypeSelector) ... ok
test_all_missing (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_missing_na (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_no_parent (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_numpy_array (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_parent_prior (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_unknown_missing_imputation (tests.test_encoders.TestNestedTargetEncoder) ... ok
test_max_works (tests.test_encoders.TestQuantileEncoder) ... ok
test_median_works (tests.test_encoders.TestQuantileEncoder) ... ok
test_new_category (tests.test_encoders.TestQuantileEncoder) ... ok
test_several_quantiles (tests.test_encoders.TestSummaryEncoder) ... ok
test_period_mapping (tests.test_preprocessing.TestCyclicFeaturizer)
Expect same output by specifying period mapping ... ok
test_trigonometry (tests.test_preprocessing.TestCyclicFeaturizer)
Expect cosines and sines to work ... ok
test_with_intercept (tests.test_linear_model.TestQuantileRegression) ... ok
test_without_intercept (tests.test_linear_model.TestQuantileRegression) ... ok
test_1_tree (tests.test_ensemble.TestMedianForest) ... ok
test_2_trees (tests.test_ensemble.TestMedianForest) ... ok
test_many_trees (tests.test_ensemble.TestMedianForest) ... ok
test_cross_val_integration (tests.test_model_selection.TestBootstrapFold)
Check cv is compatible with cross_val_score ... ok
test_grid_integration (tests.test_model_selection.TestBootstrapFold)
Check that cv is compatible with GridSearchCV ... ok
test_n_splits (tests.test_model_selection.TestBootstrapFold)
Check that get_n_splits returns the number of bootstraps ... ok
test_size_fraction_works (tests.test_model_selection.TestBootstrapFold)
Check that size_fraction works as expected ... ok

----------------------------------------------------------------------
Ran 36 tests in 2.041s

OK
</code></pre></div></div>

<p>The tests are passing, yay!</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="david26694/david-masip-blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/david-masip-blog/code/2020/08/01/github-actions.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/david-masip-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/david-masip-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/david-masip-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/david26694" title="david26694"><svg class="svg-icon grey"><use xlink:href="/david-masip-blog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
